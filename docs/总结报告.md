# 📚 Stack Overflow 文本聚类项目分布式处理总结报告

## 1. 🎯 项目概述与环境构建

本项目旨在利用分布式计算框架，对 **152,758 条** `oracle-database` 相关的 Stack Overflow 问题进行高精度语义聚类。通过环境的统一隔离与算子的并行化，实现了海量文本的快速去重与分析。

### 1.1 分布式环境配置

- **集群架构：** 采用 Spark Standalone 模式，构建由 Master 节点与多个 Worker 节点组成的计算集群。

- **环境一致性：** 全局使用 **Conda + Python 3.8** 构建虚拟环境，通过预分发环境包确保所有节点依赖库版本完全一致。

- **编程接口：** 统一利用 **PySpark** 作为核心编程接口。

### 1.2 分布式向量化 (Vectorization)

- **输入数据：** 152,758 条问答文本，存储于分布式文件系统。

- **并行推理：** 采用 **Sentence Transformers** (`all-MiniLM-L6-v2`) 模型。通过 **PySpark UDF (User Defined Function)** 封装模型推理逻辑，使各 Worker 节点能并行生成 384 维的 L2 归一化语义向量。

---

## 2. 📉 分布式降维与空间分析

为了应对高维特征带来的“维度灾难”并提升聚类效率，项目采用了分布式降维策略。

### 2.1 PCA 分布式降维

- **技术实现：** 放弃单机版 PCA，采用 **Spark MLlib 中的 PCA 算子**。

- **维度选型：** 选定 **256 维**作为最终聚类输入，方差解释率高达 **97.68%**，在大幅压减计算量的同时，近乎完整保留了原始语义信息。不同维度的方差解释率参见附表 1。

### 2.2 可视化验证

- **策略：** 利用 PCA 降维后的数据，辅助展示 **t-SNE** 与 **3D UMAP** 文件。

- **观察结论：** 降维后的空间分布呈现非球形、多核心团簇结构，证实了数据内部存在复杂的语义子群（如下图所示）。

  ![](总结报告_md_files/1ba7dea0-df41-11f0-a252-c16e3fc0b4ec.jpeg?v=1&type=image)

---

## 3. ⚙️ 聚类模型选型与分布式优化

在对比了密度聚类与划分聚类后，最终选定分布式 **K-Means** 方案（DBSCAN 的失败分析参见附表 2）。

### 3.1 聚类算法升级：从单机到分布式

- **选型原因：** 实验发现 DBSCAN 在 256 维空间中由于 K-Distance 曲线无明显拐点（膝点）而失效（轮廓系数接近负值）。

- **分布式实现：** 采用 **Spark MLlib 的 K-Means 算法**。

  - **操作对象：** 在 **Spark DataFrame** 上进行分布式训练。

  - **参数优化：** 通过计算 **Davies-Bouldin Index (DBI)** 确定全局最优 K 值（确定过程参见附表 3）。

### 3.2 最终模型参数

- **簇数量 (K)：** 1180

- **输出产物：** 产出带有 `prediction` (即 **Cluster ID**) 标签的分布式 DataFrame。

- **效果验证：** 抽检 **Cluster ID 1061**（Oracle 配置相关），发现其内部语义一致性极高，证明分布式 K-Means 能精准捕捉精细主题。

  聚类效果如下图所示

  ![](总结报告_md_files/5f4e2330-df41-11f0-a252-c16e3fc0b4ec.jpeg?v=1&type=image)

---

## 4. ✅ 多维度评估与去重分析

项目设计了严谨的九大指标体系（相关指标参见附表 4）与六类对照基线（相关对照基线介绍参见附表 5），验证聚类结构的真实性。

### 4.1 核心评估指标

- **DBI (Davies-Bouldin Index)：** 在 \$K\=1180\$ 时达到全局最低值 **3.6190**，证明在该分辨率下簇间分离度与簇内紧致度达到平衡。

- **对照基线：** 将 KMeans 结果与随机分配（Uniform Random）、长度切分（Length Buckets）等 6 种基线对比，结果显示真实聚类在各项指标上均呈现数量级优势，如雷达图所示（量化评估结果参见附表 6）。

  ![](总结报告_md_files/d535a8d0-df40-11f0-a252-c16e3fc0b4ec.jpeg?v=1&type=image)

### 4.2 统计分析 (Analysis)

- **分析工具：** 利用 **PySpark DataFrame** 的聚合与过滤操作。

- **实现内容：** 对具有相同 `Cluster ID` 的数据进行特征提取、关键词统计及语义去重验证。

---

## 5. 🛠️ 技术栈总结与交付成果

### 5.1 技术栈汇总

| **环节**     | **关键技术**                        |
| :----------- | :---------------------------------- |
| **基础架构** | PySpark + Conda (Python 3.8)        |
| **语义抽取** | Sentence Transformers + PySpark UDF |
| **数据降维** | Spark MLlib (PCA)                   |
| **核心聚类** | Spark MLlib (K-Means, K\=1180)      |
| **统计分析** | PySpark DataFrame Operations        |

### 5.2 交付成果

github 链接：[StackOverflow-Clustering](https://github.com/destinybird/StackOverflow-Clustering)

## 6. 附录

### 附表 1

| **目标维度** | **方差解释率 (信息保留率)** | **结论**                                   |
| :----------- | :-------------------------- | :----------------------------------------- |
| **256 维**   | **97.68%**                  | **最终输入**，最大程度保留了原始语义信息。 |
| 100 维       | 77.1%                       | 信息保留率不足，不适用于高精度去重。       |
| 50 维        | 60.52%                      | 语义细节大量丢失。                         |

### 附表 2

#### 网格搜索详细数据 (Grid Search Metrics)

| Eps ($eps$) | Min Samples | Clusters | Noise Ratio | Silhouette Score | 状态/评价                          |
| :---------- | :---------- | :------- | :---------- | :--------------- | :--------------------------------- |
| **0.5**     | 3           | 7        | 6.53%       | -0.1043          | 效果差                             |
| 0.5         | 5 / 10      | 0        | 6.55%       | N/A              | **忽略** (无簇)                    |
| **0.6**     | 3           | 45       | 6.34%       | -0.1854          | 轮廓系数低                         |
| 0.6         | 5           | 8        | 6.46%       | -0.1127          | -                                  |
| **0.7**     | 3           | 142      | 5.56%       | -0.2128          | -                                  |
| 0.7         | 10          | 6        | 6.22%       | -0.0917          | -                                  |
| **0.8**     | 3           | 112      | 3.65%       | -0.1885          | -                                  |
| 0.8         | 5           | 52       | 4.21%       | -0.1584          | -                                  |
| **0.85**    | 3           | 72       | 2.48%       | -0.1593          | -                                  |
| **0.9**     | **5**       | **6**    | **1.62%**   | **-0.0407**      | **Grid Search 最佳参数，仍不够好** |
| 0.95        | 3           | 10       | 0.55%       | -0.0807          | -                                  |
| 1.0+        | Any         | < 2      | < 0.2%      | N/A              | **忽略** (合并为单一簇)            |

### 附表 3

#### 关键 K 值指标变化表 (DBI 越低越好)

| K 值     | DBI Score (↓) | Inertia   | 备注                         |
| :------- | :------------ | :-------- | :--------------------------- |
| 20       | 4.2614        | 123657    | 起始点，误差大               |
| 100      | 4.0917        | 109631    | -                            |
| 300      | 4.1544        | 101590    | -                            |
| 500      | 4.0468        | 98147     | -                            |
| 800      | 3.8897        | 95178     | 指标开始显著优化             |
| 1000     | 3.7491        | 94035     | 进入最优区间                 |
| 1100     | 3.7099        | 93486     | -                            |
| 1140     | 3.6735        | 93194     | -                            |
| 1160     | 3.7013        | 93054     | -                            |
| **1180** | **3.6190**    | **92946** | **★ 全局最优 (Global Best)** |
| 1200     | 3.6768        | 93062     | 过拟合/指标回弹              |

如柱状图所示

![](总结报告_md_files/ee748500-df40-11f0-a252-c16e3fc0b4ec.jpeg?v=1&type=image)

### 附表 4

#### 九大聚类指标

#### 九大聚类指标说明表

| 指标 (Metric)                 | 定义 (Definition)                                     | 优化方向 | 衡量维度                      |
| :---------------------------- | :---------------------------------------------------- | :------- | :---------------------------- |
| Silhouette Score              | (最近邻簇间距 - 簇内间距) / max(二者)                 | 越高越好 | 紧致度与分离度的综合平衡      |
| Davies–Bouldin Index (DBI)    | 各簇(簇内距离之和 / 簇中心间距)的最大值的平均数       | 越低越好 | 分离度 (项目核心主指标)       |
| Calinski–Harabasz Index (CHI) | (类间方差 / 类内方差) \* (样本数-类别数) / (类别数-1) | 越高越好 | 整体结构性 (方差贡献比)       |
| Dunn Index                    | 最小簇间距 / 最大簇直径                               | 越高越好 | 结构性 (极端间距对比)         |
| Cohesion (内聚度)             | 簇内所有样本到其所属簇中心的平均距离                  | 越低越好 | 紧致度 (簇内紧密程度)         |
| Separation (分离度)           | 所有簇中心两两之间的平均距离                          | 越高越好 | 分离度 (簇间隔离程度)         |
| Cosine Intra Similarity       | 簇内样本与簇中心向量的余弦相似度平均值                | 越高越好 | 紧致度 (语义向量夹角一致性)   |
| Cosine Inter Similarity       | 不同簇中心向量两两之间的余弦相似度平均值              | 越低越好 | 分离度 (语义主题区分度)       |
| Singleton Ratio               | 样本量仅为 1 的簇在总簇数中的占比                     | 越低越好 | 噪声程度 (反映分群碎片化情况) |

### 附表 5

#### 六种对照基线

| **Baseline**                | **描述**                                                 | **用途**                                                       |
| :-------------------------- | :------------------------------------------------------- | :------------------------------------------------------------- |
| **Uniform Random**          | 完全随机将样本分配到 K 个簇。                            | 验证真实聚类是否明显优于**随机噪声**。                         |
| **Shuffle True Size**       | 保持真实聚类簇大小分布，但随机打乱样本归属。             | 消除**簇大小分布**对指标的影响，判断结构性是否源于内容。       |
| **Length Buckets**          | 按文本**长度**排序后，均匀切成 K 段。                    | 检验“文本长短”是否主导聚类结构。                               |
| **PCA-1 Buckets**           | 按 **PCA 第一主成分**排序后，均匀切成 K 段。             | 判断聚类是否仅沿着样本主变化方向进行简单切分。                 |
| **Random Centroid Voronoi** | 随机生成 K 个中心点，进行 Voronoi 划分。                 | 模拟**随机空间划分**，观察真实聚类是否显著优于此种无结构划分。 |
| **KMeans++ One-Shot**       | 使用 KMeans++ 初始化中心，**但不进行任何 EM 优化迭代**。 | 衡量 **KMeans 迭代优化**的必要性。                             |

### 附表 6

#### 量化评估结果

所有聚类方案（K\=20, 100, 250, 500, 1180, 2000）均进行了全面指标计算。以下展示对比结果。

K \= 20、100 、250、500、1180、2000 的数据对比如下：

| Variant           | Sil ↑      | DBI ↓      | CHI ↑       | Dunn ↑     | Coh ↓      | Sep ↑      | CosIntra ↑ | CosInter ↓  | Single ↓  |
| ----------------- | ---------- | ---------- | ----------- | ---------- | ---------- | ---------- | ---------- | ----------- | --------- |
| **kmeans**        | **0.0307** | **4.2614** | **1897.61** | **0.2156** | **1.2646** | **0.6171** | **0.4335** | **-0.0444** | **0.000** |
| uniform_random    | -0.0090    | 141.18     | 0.99        | 0.0078     | 1.4110     | 0.0161     | 0.0162     | 0.5074      | 0.000     |
| shuffle_size      | -0.0103    | 142.85     | 1.01        | 0.0076     | 1.4110     | 0.0163     | 0.0162     | 0.4853      | 0.000     |
| length_buckets    | -0.0106    | 95.05      | 37.71       | 0.0079     | 1.4077     | 0.0811     | 0.0575     | 0.1120      | 0.000     |
| pca1_buckets      | -0.0126    | 29.72      | 790.54      | 0.0294     | 1.3446     | 0.3745     | 0.2710     | 0.0044      | 0.000     |
| random_centroid   | -0.0101    | 7.52       | 484.86      | 0.1421     | 1.3679     | 0.3361     | 0.2369     | -0.0468     | 0.000     |
| kmeanspp_one_shot | 0.0104     | 5.63       | 1429.13     | 0.1548     | 1.2946     | 0.5458     | 0.3858     | -0.0422     | 0.000     |

| Variant           | Sil ↑      | DBI ↓      | CHI ↑      | Dunn ↑     | Coh ↓      | Sep ↑      | CosIntra ↑ | CosInter ↓  | Single ↓  |
| ----------------- | ---------- | ---------- | ---------- | ---------- | ---------- | ---------- | ---------- | ----------- | --------- |
| **kmeans**        | **0.0238** | **4.0917** | **609.86** | **0.1854** | **1.1899** | **0.7469** | **0.5295** | **-0.0049** | **0.000** |
| uniform_random    | -0.0300    | 66.41      | 1.01       | 0.0157     | 1.4103     | 0.0362     | 0.0281     | 0.1642      | 0.000     |
| shuffle_size      | -0.0357    | 70.12      | 0.99       | 0.0114     | 1.4104     | 0.0377     | 0.0275     | 0.1604      | 0.000     |
| length_buckets    | -0.0316    | 59.10      | 8.54       | 0.0162     | 1.4068     | 0.0888     | 0.0636     | 0.0987      | 0.000     |
| pca1_buckets      | -0.0351    | 51.74      | 154.20     | 0.0168     | 1.3429     | 0.3640     | 0.2727     | 0.0434      | 0.000     |
| random_centroid   | -0.0301    | 6.67       | 158.26     | 0.1520     | 1.3384     | 0.4179     | 0.3027     | -0.0072     | 0.000     |
| kmeanspp_one_shot | 0.0064     | 4.88       | 486.04     | 0.1525     | 1.2211     | 0.6795     | 0.4874     | -0.0056     | 0.000     |

| Variant           | Sil ↑      | DBI ↓      | CHI ↑      | Dunn ↑     | Coh ↓      | Sep ↑      | CosIntra ↑ | CosInter ↓  | Single ↓  |
| ----------------- | ---------- | ---------- | ---------- | ---------- | ---------- | ---------- | ---------- | ----------- | --------- |
| **kmeans**        | **0.0167** | **4.1192** | **298.55** | **0.1780** | **1.1489** | **0.7972** | **0.5695** | **-0.0017** | **0.000** |
| uniform_random    | -0.0645    | 43.07      | 0.99       | 0.0243     | 1.4089     | 0.0566     | 0.0416     | 0.0738      | 0.000     |
| shuffle_size      | -0.0751    | 44.16      | 1.01       | 0.0197     | 1.4091     | 0.0601     | 0.0417     | 0.0691      | 0.000     |
| length_buckets    | -0.0669    | 39.69      | 4.04       | 0.0249     | 1.4053     | 0.1017     | 0.0723     | 0.0622      | 0.000     |
| pca1_buckets      | -0.0618    | 37.66      | 61.95      | 0.0252     | 1.3417     | 0.3668     | 0.2748     | 0.0464      | 0.000     |
| random_centroid   | -0.0603    | 6.06       | 91.17      | 0.1527     | 1.3060     | 0.4818     | 0.3571     | -0.0008     | 0.000     |
| kmeanspp_one_shot | -0.0038    | 4.72       | 245.12     | 0.1335     | 1.1838     | 0.7408     | 0.5325     | -0.0008     | 0.000     |

| Variant           | Sil ↑      | DBI ↓      | CHI ↑      | Dunn ↑     | Coh ↓      | Sep ↑      | CosIntra ↑ | CosInter ↓  | Single ↓  |
| ----------------- | ---------- | ---------- | ---------- | ---------- | ---------- | ---------- | ---------- | ----------- | --------- |
| **kmeans**        | **0.0024** | **4.0468** | **170.83** | **0.1663** | **1.1207** | **0.8373** | **0.5964** | **-0.0005** | **0.002** |
| uniform_random    | -0.1278    | 30.75      | 1.00       | 0.0340     | 1.4066     | 0.0806     | 0.0580     | 0.0373      | 0.000     |
| shuffle_size      | -0.1519    | 31.90      | 1.00       | 0.0280     | 1.4071     | 0.0899     | 0.0572     | 0.0355      | 0.002     |
| length_buckets    | -0.1212    | 29.15      | 2.51       | 0.0349     | 1.4030     | 0.1182     | 0.0837     | 0.0386      | 0.000     |
| pca1_buckets      | -0.1061    | 27.75      | 31.41      | 0.0299     | 1.3383     | 0.3715     | 0.2780     | 0.0450      | 0.000     |
| random_centroid   | -0.1092    | 5.74       | 51.51      | 0.1326     | 1.2931     | 0.5134     | 0.3766     | 0.0003      | 0.000     |
| kmeanspp_one_shot | -0.0212    | 4.61       | 143.71     | 0.1236     | 1.1529     | 0.7856     | 0.5638     | -0.0001     | 0.000     |

| Variant           | Sil ↑       | DBI ↓      | CHI ↑     | Dunn ↑     | Coh ↓      | Sep ↑      | CosIntra ↑ | CosInter ↓ | Single ↓   |
| ----------------- | ----------- | ---------- | --------- | ---------- | ---------- | ---------- | ---------- | ---------- | ---------- |
| **kmeans**        | **-0.0187** | **3.6190** | **83.37** | **0.1537** | **1.0861** | **0.9262** | **0.6247** | **0.0008** | **0.0712** |
| uniform_random    | -0.2140     | 20.45      | 0.99      | 0.0496     | 1.4004     | 0.1239     | 0.0879     | 0.0167     | 0.000      |
| shuffle_size      | -0.2102     | 20.17      | 1.00      | 0.0339     | 1.4031     | 0.2785     | 0.0825     | 0.0133     | 0.0712     |
| length_buckets    | -0.2138     | 19.57      | 1.65      | 0.0497     | 1.3969     | 0.1533     | 0.1083     | 0.0178     | 0.000      |
| pca1_buckets      | -0.1809     | 18.82      | 13.87     | 0.0400     | 1.3270     | 0.3856     | 0.2867     | 0.0381     | 0.000      |
| random_centroid   | -0.1454     | 5.27       | 27.04     | 0.1530     | 1.2633     | 0.5640     | 0.4136     | 0.0022     | 0.000      |
| kmeanspp_one_shot | -0.0489     | 4.41       | 72.67     | 0.1432     | 1.1138     | 0.8354     | 0.5990     | 0.0012     | 0.000      |

| Variant           | Sil ↑       | DBI ↓      | CHI ↑     | Dunn ↑     | Coh ↓      | Sep ↑      | CosIntra ↑ | CosInter ↓ | Single ↓  |
| ----------------- | ----------- | ---------- | --------- | ---------- | ---------- | ---------- | ---------- | ---------- | --------- |
| **kmeans**        | **-0.0249** | **3.1489** | **52.50** | **0.1812** | **1.0721** | **1.0227** | **0.6379** | **0.0005** | **0.187** |
| uniform_random    | -0.2068     | 15.82      | 0.99      | 0.0606     | 1.3929     | 0.1621     | 0.1144     | 0.0095     | 0.000     |
| shuffle_size      | -0.2149     | 14.48      | 1.00      | 0.0362     | 1.4003     | 0.5080     | 0.0997     | 0.0071     | 0.187     |
| length_buckets    | -0.2017     | 15.42      | 1.38      | 0.0605     | 1.3900     | 0.1857     | 0.1311     | 0.0106     | 0.000     |
| pca1_buckets      | -0.1764     | 14.67      | 8.60      | 0.0490     | 1.3082     | 0.4014     | 0.2967     | 0.0315     | 0.000     |
| random_centroid   | -0.1403     | 4.93       | 18.15     | 0.1498     | 1.2368     | 0.5996     | 0.4372     | 0.0033     | 0.000     |
| kmeanspp_one_shot | -0.0485     | 4.20       | 47.69     | 0.1415     | 1.0878     | 0.8675     | 0.6206     | 0.0012     | 0.000     |
