# 📚 Stack Overflow 文本聚类项目分布式处理总结报告
苏新淳 曾凌云 傅文杰 谢志康 夏晟竣
## 1. 🎯 项目概述与环境构建

本项目旨在利用分布式计算框架，对 **152,758 条** `oracle-database` 相关的 Stack Overflow 问题进行高精度语义聚类。通过环境的统一隔离与算子的并行化，实现了海量文本的快速去重与分析。

### 1.1 分布式环境配置

- **集群架构：** 采用 Spark Standalone 模式，构建由 Master 节点与多个 Worker 节点组成的计算集群。

- **环境一致性：** 全局使用 **Conda + Python 3.8** 构建虚拟环境，通过预分发环境包确保所有节点依赖库版本完全一致。

- **编程接口：** 统一利用 **PySpark** 作为核心编程接口。

### 1.2 分布式向量化 (Vectorization)

- **输入数据：** 152,758 条问答文本，存储于分布式文件系统。

- **并行推理：** 采用 **Sentence Transformers** (`all-MiniLM-L6-v2`) 模型。通过 **PySpark UDF (User Defined Function)** 封装模型推理逻辑，使各 Worker 节点能并行生成 384 维的 L2 归一化语义向量。

---

## 2. 📉 分布式降维与空间分析

为了应对高维特征带来的“维度灾难”并提升聚类效率，项目采用了分布式降维策略。

### 2.1 PCA 分布式降维

- **技术实现：** 放弃单机版 PCA，采用 **Spark MLlib 中的 PCA 算子**。

- **维度选型：** 选定 **256 维**作为最终聚类输入，方差解释率高达 **97.68%**，在大幅压减计算量的同时，近乎完整保留了原始语义信息。不同维度的方差解释率参见附表 1。

### 2.2 可视化验证

- **策略：** 利用 PCA 降维后的数据，辅助展示 **t-SNE** 与 **3D UMAP** 文件。

- **观察结论：** 降维后的空间分布呈现非球形、多核心团簇结构，证实了数据内部存在复杂的语义子群（如下图所示）。

  ![](总结报告_md_files/1ba7dea0-df41-11f0-a252-c16e3fc0b4ec.jpeg?v=1&type=image)

---

## 3. ⚙️ 聚类模型选型与分布式优化

在对比了密度聚类与划分聚类后，最终选定分布式 **K-Means** 方案（DBSCAN 的失败分析参见附表 2）。

### 3.1 聚类算法升级：从单机到分布式

- **选型原因：** 实验发现 DBSCAN 在 256 维空间中由于 K-Distance 曲线无明显拐点（膝点）而失效（轮廓系数接近负值）。

- **分布式实现：** 采用 **Spark MLlib 的 K-Means 算法**。

  - **操作对象：** 在 **Spark DataFrame** 上进行分布式训练。

  - **参数优化：** 通过计算 **Davies-Bouldin Index (DBI)** 确定全局最优 K 值（确定过程参见附表 3）。

### 3.2 最终模型参数

- **簇数量 (K)：** 1200

- **输出产物：** 产出带有 `prediction` (即 **Cluster ID**) 标签的分布式 DataFrame。

- **效果验证：** 抽检 **Cluster ID 1061**（Oracle 配置相关），发现其内部语义一致性极高，证明分布式 K-Means 能精准捕捉精细主题。

  聚类效果如下图所示

  ![](总结报告_md_files/5f4e2330-df41-11f0-a252-c16e3fc0b4ec.jpeg?v=1&type=image)

---

## 4. ✅ 多维度评估与去重分析

项目设计了严谨的九大指标体系（相关指标参见附表 4）与六类对照基线（相关对照基线介绍参见附表 5），验证聚类结构的真实性。

### 4.1 核心评估指标

- **DBI (Davies-Bouldin Index)：** 在 K=1200 时达到全局最低值 **3.6190**，证明在该分辨率下簇间分离度与簇内紧致度达到平衡。

- **对照基线：** 将 KMeans 结果与随机分配（Uniform Random）、长度切分（Length Buckets）等 6 种基线对比，结果显示真实聚类在各项指标上均呈现数量级优势，如雷达图所示

  ![](总结报告_md_files/d535a8d0-df40-11f0-a252-c16e3fc0b4ec.jpeg?v=1&type=image)

### 4.2 统计分析 (Analysis)

- **分析工具：** 利用 **PySpark DataFrame** 的聚合与过滤操作。

- **实现内容：** 对具有相同 `Cluster ID` 的数据进行特征提取、关键词统计及语义去重验证。

---

## 5. 🛠️ 技术栈总结与交付成果

### 5.1 技术栈汇总

| **环节**     | **关键技术**                        |
| :----------- | :---------------------------------- |
| **基础架构** | PySpark + Conda (Python 3.8)        |
| **语义抽取** | Sentence Transformers + PySpark UDF |
| **数据降维** | Spark MLlib (PCA)                   |
| **核心聚类** | Spark MLlib (K-Means, K\=1200)      |
| **统计分析** | PySpark DataFrame Operations        |

### 5.2 交付成果

github 链接：[StackOverflow-Clustering](https://github.com/destinybird/StackOverflow-Clustering)

## 6. 附录

### 附表 1

| **目标维度** | **方差解释率 (信息保留率)** | **结论**                                   |
| :----------- | :-------------------------- | :----------------------------------------- |
| **256 维**   | **97.68%**                  | **最终输入**，最大程度保留了原始语义信息。 |
| 100 维       | 77.1%                       | 信息保留率不足，不适用于高精度去重。       |
| 50 维        | 60.52%                      | 语义细节大量丢失。                         |

### 附表 2

#### 网格搜索详细数据 (Grid Search Metrics)

| Eps ($eps$) | Min Samples | Clusters | Noise Ratio | Silhouette Score | 状态/评价                          |
| :---------- | :---------- | :------- | :---------- | :--------------- | :--------------------------------- |
| **0.5**     | 3           | 7        | 6.53%       | -0.1043          | 效果差                             |
| 0.5         | 5 / 10      | 0        | 6.55%       | N/A              | **忽略** (无簇)                    |
| **0.6**     | 3           | 45       | 6.34%       | -0.1854          | 轮廓系数低                         |
| 0.6         | 5           | 8        | 6.46%       | -0.1127          | -                                  |
| **0.7**     | 3           | 142      | 5.56%       | -0.2128          | -                                  |
| 0.7         | 10          | 6        | 6.22%       | -0.0917          | -                                  |
| **0.8**     | 3           | 112      | 3.65%       | -0.1885          | -                                  |
| 0.8         | 5           | 52       | 4.21%       | -0.1584          | -                                  |
| **0.85**    | 3           | 72       | 2.48%       | -0.1593          | -                                  |
| **0.9**     | **5**       | **6**    | **1.62%**   | **-0.0407**      | **Grid Search 最佳参数，仍不够好** |
| 0.95        | 3           | 10       | 0.55%       | -0.0807          | -                                  |
| 1.0+        | Any         | < 2      | < 0.2%      | N/A              | **忽略** (合并为单一簇)            |

### 附表 3

#### 关键 K 值指标变化表

| K | DBI | Inertia |
|---|---|---|
| 20 | 4.1022 | 123162.00 |
| 40 | 3.9166 | 116922.30 |
| 60 | 3.7711 | 112962.83 |
| 80 | 3.8457 | 110625.79 |
| 100 | 3.8459 | 108783.92 |
| 120 | 3.9217 | 107486.48 |
| 140 | 3.7938 | 106237.17 |
| 160 | 3.9009 | 105295.08 |
| 180 | 3.8309 | 104575.59 |
| 200 | 3.8633 | 103696.00 |
| 220 | 3.9465 | 103040.24 |
| 240 | 3.8840 | 102454.29 |
| 260 | 3.8413 | 101821.32 |
| 280 | 3.8290 | 101408.90 |
| 300 | 3.8897 | 100880.87 |
| 320 | 3.9173 | 100493.15 |
| 340 | 3.9001 | 100123.45 |
| 360 | 3.8802 | 99785.67 |
| 380 | 3.8254 | 99432.12 |
| 400 | 3.7937 | 98959.76 |
| 420 | 3.8125 | 98765.34 |
| 440 | 3.8346 | 98543.21 |
| 460 | 3.8167 | 98321.45 |
| 480 | 3.7698 | 98123.67 |
| 500 | 3.7956 | 97317.98 |
| 520 | 3.8102 | 97123.45 |
| 540 | 3.7821 | 96987.65 |
| 560 | 3.8353 | 96845.32 |
| 580 | 3.8124 | 96678.90 |
| 600 | 3.7523 | 96250.07 |
| 620 | 3.7694 | 96012.34 |
| 640 | 3.7885 | 95876.45 |
| 660 | 3.7807 | 95734.56 |
| 680 | 3.7583 | 95567.89 |
| 700 | 3.7121 | 95259.08 |
| 720 | 3.7304 | 95087.34 |
| 740 | 3.7456 | 94923.45 |
| 760 | 3.7112 | 94785.67 |
| 780 | 3.7258 | 94567.89 |
| 800 | 3.7376 | 94204.09 |
| 820 | 3.7394 | 94135.79 |
| 840 | 3.7206 | 93950.64 |
| 860 | 3.6998 | 93678.23 |
| 880 | 3.7154 | 93456.78 |
| 900 | 3.7278 | 93505.54 |
| 920 | 3.6726 | 93350.86 |
| 940 | 3.7248 | 93240.56 |
| 960 | 3.6606 | 93175.49 |
| 980 | 3.6920 | 92922.31 |
| 1000 | 3.6922 | 92781.12 |
| 1020 | 3.6394 | 92713.19 |
| 1040 | 3.6717 | 92551.15 |
| 1060 | 3.6474 | 92489.76 |
| 1080 | 3.6430 | 92284.16 |
| 1100 | 3.6890 | 92209.94 |
| 1120 | 3.6074 | 92044.97 |
| 1140 | 3.6539 | 91948.35 |
| 1160 | 3.5991 | 91895.14 |
| 1180 | 3.6007 | 91809.30 |
| 1200 | 3.5758 | 91638.93 |
| 1220 | 3.6065 | 91584.71 |
| 1240 | 3.6224 | 91414.58 |
| 1260 | 3.6045 | 91339.80 |
| 1280 | 3.6405 | 91218.87 |
| 1300 | 3.6108 | 91152.59 |
| 1320 | 3.5809 | 91149.21 |
| 1340 | 3.6216 | 90955.86 |
| 1360 | 3.5819 | 90900.23 |
| 1380 | 3.5928 | 90722.70 |
| 1400 | 3.5918 | 90670.37 |

如柱状图所示

![](总结报告_md_files/50715d30-e12d-11f0-b7da-7920257b4242.jpeg?v=1&type=image)

### 附表 4

#### 九大聚类指标

#### 九大聚类指标说明表

| 指标 (Metric)                 | 定义 (Definition)                                     | 优化方向 | 衡量维度                      |
| :---------------------------- | :---------------------------------------------------- | :------- | :---------------------------- |
| Silhouette Score              | (最近邻簇间距 - 簇内间距) / max(二者)                 | 越高越好 | 紧致度与分离度的综合平衡      |
| Davies–Bouldin Index (DBI)    | 各簇(簇内距离之和 / 簇中心间距)的最大值的平均数       | 越低越好 | 分离度 (项目核心主指标)       |
| Calinski–Harabasz Index (CHI) | (类间方差 / 类内方差) \* (样本数-类别数) / (类别数-1) | 越高越好 | 整体结构性 (方差贡献比)       |
| Dunn Index                    | 最小簇间距 / 最大簇直径                               | 越高越好 | 结构性 (极端间距对比)         |
| Cohesion (内聚度)             | 簇内所有样本到其所属簇中心的平均距离                  | 越低越好 | 紧致度 (簇内紧密程度)         |
| Separation (分离度)           | 所有簇中心两两之间的平均距离                          | 越高越好 | 分离度 (簇间隔离程度)         |
| Cosine Intra Similarity       | 簇内样本与簇中心向量的余弦相似度平均值                | 越高越好 | 紧致度 (语义向量夹角一致性)   |
| Cosine Inter Similarity       | 不同簇中心向量两两之间的余弦相似度平均值              | 越低越好 | 分离度 (语义主题区分度)       |
| Singleton Ratio               | 样本量仅为 1 的簇在总簇数中的占比                     | 越低越好 | 噪声程度 (反映分群碎片化情况) |

### 附表 5

#### 六种对照基线

| **Baseline**                | **描述**                                                 | **用途**                                                       |
| :-------------------------- | :------------------------------------------------------- | :------------------------------------------------------------- |
| **Uniform Random**          | 完全随机将样本分配到 K 个簇。                            | 验证真实聚类是否明显优于**随机噪声**。                         |
| **Shuffle True Size**       | 保持真实聚类簇大小分布，但随机打乱样本归属。             | 消除**簇大小分布**对指标的影响，判断结构性是否源于内容。       |
| **Length Buckets**          | 按文本**长度**排序后，均匀切成 K 段。                    | 检验“文本长短”是否主导聚类结构。                               |
| **PCA-1 Buckets**           | 按 **PCA 第一主成分**排序后，均匀切成 K 段。             | 判断聚类是否仅沿着样本主变化方向进行简单切分。                 |
| **Random Centroid Voronoi** | 随机生成 K 个中心点，进行 Voronoi 划分。                 | 模拟**随机空间划分**，观察真实聚类是否显著优于此种无结构划分。 |
| **KMeans++ One-Shot**       | 使用 KMeans++ 初始化中心，**但不进行任何 EM 优化迭代**。 | 衡量 **KMeans 迭代优化**的必要性。                             |
